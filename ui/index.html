<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Network</title>
    <script
      type="text/javascript"
      src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"
    ></script>
    <style type="text/css">
      html, body { margin: 0; padding: 0;}
      #mynetwork {
        width: 100vw;
        height: 100vh;
      }
    </style>
  </head>
  <body>
    <div id="mynetwork"></div>
    <script type="text/javascript">

      async function fetchNode (id = '') {
        const res = await fetch(`/nodes/${id}`)
        const json = await res.json()
        
        var nodes = new vis.DataSet(json.nodes) // create an array with nodes
        var edges = new vis.DataSet(json.links) // create an array with edges

        nodes.map(node => {
          var svg =
  '<svg xmlns="http://www.w3.org/2000/svg" width="390" height="65">' +
  '<rect x="0" y="0" width="100%" height="100%" fill="#7890A7" stroke-width="20" stroke="#ffffff" ></rect>' +
  '<foreignObject x="15" y="10" width="100%" height="100%">' +
  '<div xmlns="http://www.w3.org/1999/xhtml" style="font-size:40px">' + node.label +
  "</div>" +
  "</foreignObject>" +
  "</svg>";

        // node.image = "data:image/svg+xml;charset=utf-8," + encodeURIComponent(svg)
        // node.shape = "image"
        })

        return { nodes, edges }
      }

      async function load(id = '') {
        const { nodes, edges } = await fetchNode(id)

        // create a network
        var container = document.getElementById('mynetwork')
        var data = { nodes, edges }
        const options = {
          nodes: {
            margin: 100
          }
        }
        var network = new vis.Network(container, data, options)

        // TODO more events... see https://visjs.github.io/vis-network/docs/network/#Events
        network.on('selectNode', async function (params) {
          const id = params.nodes[0]
          const { nodes, edges } = await fetchNode(id)
          network.setData({ nodes, edges })

          // params.event = "[original event]";
          // document.getElementById("eventSpan").innerHTML =
          //   "<h2>Click event:</h2>" + JSON.stringify(params, null, 4);
          // console.log(
          //   "click event, getNodeAt returns: " + this.getNodeAt(params.pointer.DOM)
          // );
        })
      }

      async function main () {
        load()
      }
      
      main()
    </script>
  </body>
</html>