<!DOCTYPE html>
<html lang="en">
  <head>
    <title>K-Web 0.2</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2285%22>üåê</text></svg>">

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <script src="//unpkg.com/three"></script>
    <script src="//unpkg.com/three-spritetext"></script>

    <script src="//unpkg.com/3d-force-graph"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
  </head>
  <body>
    <style>
      #search-container {
        position: absolute;
        top: 4px;
        left: 35%;
        transform: translate(-50%);
        z-index: 10;
      }
      #search-bar input[type="text"] {
        width: 300px;
      }
      #search-container {
        display: flex;
        flex-direction: column;
      }
      #search-container .results {
        margin-top: 4px;
        font-family: Arial, sans-serif;
        color: white;
        /* background-color: rgba(255, 255, 255, 0.1); */
        background: black;
        z-index: 10;
      }
      #search-container .results a {
        display: block;
        width: 100%;
        color: #eee;
        text-decoration: none;
      }
      #search-container .results a:hover {
        color: #fff;
        background-color: rgba(255, 255, 255, 0.2);
      }
      #map {
        border-radius: 0 0 20px 0;
        opacity: 0.75;
        transition: opacity 0.5s ease-in-out;
        position: absolute;
        top: 0;
        left: 0;
        width: 300px;
        height: 300px;
        z-index: 1;
      }
      #map:hover {
        opacity: 1;
        transition: opacity 0.1s ease-in-out;
      }
    </style>

    <div id="map"></div>

    <div id="search-container">
      <div id="search-bar" style="display: flex; justify-content: center; align-items: center;">
        <form style="display: flex; justify-content: center; align-items: center;">
          <input class="search" type="text" placeholder="Search..." style="padding: 10px; border-radius: 5px; border: none; margin-right: 10px;">
          <!-- <button class="search" type="submit" style="padding: 10px; border-radius: 5px; border: none; background-color: #008CBA; color: white; margin-right: 10px;">üîé Search</button> -->
          <button class="random" type="button" onclick="" style="padding: 10px; border-radius: 5px; border: none; background-color: #008CBA; color: white; cursor: pointer;">üé≤</button>
        </form>
      </div>
      <div class="results"></div>
    </div>
    
    <div id="graph"></div>
    <div id="content"></div>
    
    <div id="info"><a href="/info">What is this?</a></div>
    
    <script type="importmap">{ "imports": { "three": "https://unpkg.com/three/build/three.module.js" }}</script>
    <script type="module" src="script.js"></script>

    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDhy1d5cJL36CkfjIcgHRDiehuXxbQEFH0&callback=initMap"></script>
    <script>

      let mapInitLocation = false
      let map = null
      console.log('adding event listener')
      window.addEventListener("show-location", function(event) {
        const location = event.detail
        // handle the event here
        console.log("Location to show:", event.detail)
        if (!map) return // FIXME
        addMarker(location)
      })

      function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: Math.random() * 180 - 90, lng: Math.random() * 360 - 180 },
          zoom: 3,
          disableDefaultUI: true
        })
      }

      let marker = null
      function addMarker (location) {
        const geocoder = new google.maps.Geocoder()
        // if location is empty, show zoomed out world map instead & remove marker
        if (!location) {
          map.setCenter({ lat: -55, lng: 10 }) // some place where you see only ocean :)
          if (marker) {
            marker.setMap(null)
            marker = null
          }
          return
        }
        geocoder.geocode({ address: location }, (results, status) => {
          if (status === "OK") {
            if (!marker) {
              marker = new google.maps.Marker({
                position: results[0].geometry.location,
                map
              })
            } else {
              marker.setPosition(results[0].geometry.location)
            }

            map.setCenter(results[0].geometry.location)
            map.panTo(marker.getPosition())
          } else {
            console.error("Geocode was not successful for the following reason: " + status)
          }
        })
      }
    </script>
  </body>
</html>